<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jogadores</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body style="padding: 20px;">

<div class="container">
    <a href="/">&larr; Voltar para a Home</a> |
    <a href="/times.html">&larr; Voltar para Times</a>

    <h1 class="mt-3" id="nome-do-time">Carregando...</h1>

    <hr>

    <h2>Jogadores do Time:</h2>
    <div id="lista-de-jogadores">
        <p>Buscando jogadores...</p>
    </div>

    <hr>
    <a href="#" class="btn btn-success" id="btn-add-jogador">Adicionar Novo Jogador</a>

</div>

<script>
    // 5. Esta função pega os parâmetros da URL
    function getParametroDaUrl(nome) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(nome);
    }

    // 6. Esta função busca os dados da nossa API
    async function buscarJogadores(idDoTime) {
        console.log(`Buscando jogadores do time ID: ${idDoTime}`);

        const response = await fetch(`/jogadores/time/${idDoTime}`);
        const jogadores = await response.json();

        console.log("Jogadores recebidos:", jogadores);
        mostrarJogadoresNaTela(jogadores);
    }

    // 8. Esta função constrói a tabela de jogadores
    function mostrarJogadoresNaTela(jogadores) {
        const container = document.getElementById('lista-de-jogadores');
        container.innerHTML = '';

        if (jogadores.length === 0) {
            container.innerHTML = '<p class="text-muted">Nenhum jogador cadastrado para este time.</p>';
            return;
        }

        const table = document.createElement('table');
        table.className = 'table table-striped';

        table.innerHTML = `
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Nome do Jogador</th>
                    <th>Nº Camisa</th>
                    <th>Posição</th>
                    <th>Ações</th>
                </tr>
            </thead>
        `;

        const tbody = document.createElement('tbody');
        jogadores.forEach(jogador => {
            const tr = document.createElement('tr');




            tr.innerHTML = `
                <td>${jogador.id}</td>
                <td>${jogador.nome}</td>
                <td>${jogador.numeroCamisa}</td>
                <td>${jogador.posicao}</td>
                <td>
                    <a href="/editar-jogador.html?jogadorId=${jogador.id}&timeId=${jogador.time.id}" class="btn btn-warning btn-sm">Editar</a>

                    <button class="btn btn-danger btn-sm" onclick="deletarJogador(${jogador.id})">Excluir</button>
                </td>
            `;


            tbody.appendChild(tr);
        });

        table.appendChild(tbody);
        container.appendChild(table);
    }

    // 9. NOVA FUNÇÃO (Coloquei aqui para organizar, antes do window.onload)
    async function deletarJogador(id) {
        if (confirm("Tem certeza que deseja excluir este jogador?")) {
            console.log(`Enviando pedido para deletar jogador ID: ${id}`);

            const response = await fetch(`/jogadores/${id}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                console.log("Jogador excluído!");
                // Recarrega a lista de jogadores para atualizar a tabela
                window.onload();
            } else {
                alert("Erro ao excluir jogador.");
            }
        }
    }

    // 10. Roda tudo assim que a página carregar
    window.onload = () => {

        const timeId = getParametroDaUrl('timeId');
        const timeNome = getParametroDaUrl('timeNome');

        const tituloEl = document.getElementById('nome-do-time');
        if (timeNome) {
            tituloEl.textContent = `Jogadores do Time: ${timeNome}`;
            document.title = `Jogadores - ${timeNome}`;
        }

        if (timeId) {
            buscarJogadores(timeId);
        } else {
            document.getElementById('lista-de-jogadores').innerHTML =
                '<p class="text-danger">Erro: ID do time não encontrado na URL.</p>';
        }

        // 13. Configura o link do botão "Adicionar Novo Jogador"
        const btnAdd = document.getElementById('btn-add-jogador');
        if (timeId && timeNome) {
         // Passa o ID e o Nome para a nova página
        btnAdd.href = `/add-jogador.html?timeId=${timeId}&timeNome=${timeNome}`;
        } else {
         // Caso de erro (não devia acontecer)
           btnAdd.href = '/add-jogador.html';
        }
    };

</script>
</body>
</html>